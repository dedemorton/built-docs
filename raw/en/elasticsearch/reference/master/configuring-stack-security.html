<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Start the Elastic Stack with security enabled | Elasticsearch Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="secure-cluster.html" title="Secure the Elastic Stack"/>
<link rel="prev" href="es-security-principles.html" title="Elasticsearch security principles"/>
<link rel="next" href="manually-configure-security.html" title="Manually configure security"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
»
<span class="breadcrumb-node">Start the Elastic Stack with security enabled</span>
</div>
<div class="navheader">
<span class="prev">
<a href="es-security-principles.html">« Elasticsearch security principles</a>
</span>
<span class="next">
<a href="manually-configure-security.html">Manually configure security »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuring-stack-security"></a>Start the Elastic Stack with security enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in alpha and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Alpha features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Before you start Elasticsearch for the first time, run the <code class="literal">elasticsearch-security-config</code>
tool. This tool generates certificates and keys for the transport and HTTP
layers of Elasticsearch, and writes the Transport Layer Security (TLS) configuration
settings to <code class="literal">elasticsearch.yml</code>. These certificates allow you to connect a
Kibana instance to your secured Elasticsearch cluster and encrypt internode communication.</p>
<p>When you start Elasticsearch for the first time, passwords are automatically generated
for the <code class="literal">elastic</code> and <code class="literal">kibana_system</code> users. Tools are available to reset these
passwords if you misplace them or need to rotate passwords.</p>
<p>You can then use the
<a class="xref" href="create-enrollment-token.html" title="elasticsearch-create-enrollment-token"><code class="literal">elasticsearch-create-enrollment-token</code></a> tool to
generate separate enrollment tokens for connecting a Kibana instance to your
secured Elasticsearch cluster and enrolling additional nodes.</p>
<p>When you complete the enrollment process for Kibana, it applies the security
settings from your Elasticsearch cluster, authenticates to Elasticsearch with the <code class="literal">kibana_system</code>
user, and writes the security configuration to <code class="literal">kibana.yml</code>. A security
certificate is generated in the Kibana configuration directory. This
file establishes trust between Kibana and the Elasticsearch Certificate Authority (CA) for
the HTTP layer.</p>
<h3><a id="_prerequisites_10"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/downloads/elasticsearch#preview-release" class="ulink" target="_top">Download</a> and
unpack the <code class="literal">elasticsearch 8.0.0-alpha2</code> package distribution for your
environment.
</li>
<li class="listitem">
<a href="/downloads/kibana#preview-release" class="ulink" target="_top">Download</a> and unpack
the <code class="literal">kibana 8.0.0-alpha2</code> package distribution for your environment.
</li>
</ul>
</div>
<h3><a id="stack-generate-certificates"></a>Generate security certificates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Before starting Elasticsearch for the first time, run the
<code class="literal">elasticsearch-security-config</code> tool from the directory where you downloaded
the Elasticsearch package distribution:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-security-config</pre>
</div>
<p>The <code class="literal">elasticsearch-security-config</code> tool generates the following security
certificates and keys in <code class="literal">config/tls_auto_config_&lt;timestamp&gt;</code>:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">http_ca.crt</code>
</span>
</dt>
<dd>
The CA certificate that is used to sign the certificates for the HTTP layer of
this Elasticsearch cluster.
</dd>
<dt>
<span class="term">
<code class="literal">http_keystore_local_node.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the HTTP layer for this node.
</dd>
<dt>
<span class="term">
<code class="literal">transport_keystore_all_nodes.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the transport layer for all the nodes in your cluster.
</dd>
</dl>
</div>
</li>
</ol>
</div>
<h3><a id="stack-start-with-security"></a>Start Elasticsearch and enroll Kibana with security enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the installation directory, start Elasticsearch. Passwords for the <code class="literal">elastic</code> and
<code class="literal">kibana_system</code> users are generated and output to the terminal.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You might need to scroll back a bit in the terminal to view the passwords.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Copy the generated passwords and save them in a secure location. The passwords
are shown only when you start Elasticsearch for the first time.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you need to reset the password for the <code class="literal">elastic</code> user, run the
<a class="xref" href="reset-elastic-password.html" title="elasticsearch-reset-elastic-password"><code class="literal">elasticsearch-reset-elastic-password</code></a> tool. To
reset the password for the <code class="literal">kibana_system</code> user, run the
<code class="literal">elasticsearch-reset-kibana-system-password</code> tool. Both of these tools are
available in the Elasticsearch <code class="literal">/bin</code> directory.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Open a new terminal and verify that you can connect to your Elasticsearch cluster by
making an authenticated call. Enter the password for the <code class="literal">elastic</code> user when
prompted:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl --cacert config/tls_auto_config_&lt;timestamp&gt;/http_ca.crt \
-u elastic https://localhost:9200 <a id="CO516-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO516-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Ensure that you use <code class="literal">https</code> in your call, or the request will fail.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">--cacert</code>
</span>
</dt>
<dd>
Path to the generated <code class="literal">http_ca.crt</code> certificate for the HTTP layer.
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>In your new terminal, navigate to the directory where you installed Elasticsearch, and
run the <a class="xref" href="create-enrollment-token.html" title="elasticsearch-create-enrollment-token"><code class="literal">elasticsearch-create-enrollment-token</code></a> tool
to generate an enrollment token for Kibana.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-create-enrollment-token -s kibana</pre>
</div>
<p>Copy the enrollment token, which you&#8217;ll use to enroll Kibana with your Elasticsearch
cluster.</p>
</li>
<li class="listitem">
<p>From the directory where you installed Kibana, start Kibana in interactive mode.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/kibana --interactiveSetup.enabled=true</pre>
</div>
<p>This command generates a unique link to enroll your Kibana instance with Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your terminal, click the generated link to open Kibana in your browser.
</li>
<li class="listitem">
In your browser, paste the enrollment token that you copied and click the
button to connect your Kibana instance with Elasticsearch.
</li>
<li class="listitem">
Log in to Kibana as the <code class="literal">elastic</code> user with the password that was generated
when you started Elasticsearch.
</li>
</ol>
</div>
</li>
</ol>
</div>
<h3><a id="stack-enroll-nodes"></a>Enroll additional nodes in your cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In a separate terminal from where Elasticsearch is running, navigate to the directory
where you installed Elasticsearch and run the
<a class="xref" href="create-enrollment-token.html" title="elasticsearch-create-enrollment-token"><code class="literal">elasticsearch-create-enrollment-token</code></a> tool
to generate an enrollment token for your additional nodes.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-create-enrollment-token -s node</pre>
</div>
<p>Copy the enrollment token, which you&#8217;ll use to enroll additional nodes with
your Elasticsearch cluster.</p>
</li>
<li class="listitem">
<p>From the installation directory of your other node, run the
<code class="literal">elasticsearch-enroll-node</code> tool and pass your enrollment token with the
<code class="literal">--enrollment token</code> parameter.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-enroll-node --enrollment token &lt;enrollment-token&gt;</pre>
</div>
</li>
<li class="listitem">
Repeat the previous step for any additional nodes that you want to enroll.
</li>
<li class="listitem">
<p>Start your new nodes, which Elasticsearch automatically enrolls into the existing
cluster.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch</pre>
</div>
</li>
</ol>
</div>
<h3><a id="_whats_next"></a>What&#8217;s next?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<p>Congratulations! You&#8217;ve successfully started the Elastic Stack with security enabled. Elasticsearch
and Kibana are secured with TLS on the HTTP layer, and internode communication
is encrypted. If you want to enable HTTPS for web traffic, you
can <a class="xref" href="security-basic-setup-https.html#encrypt-kibana-browser" title="Encrypt traffic between your browser and Kibana">encrypt traffic between your browser and Kibana</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="es-security-principles.html">« Elasticsearch security principles</a>
</span>
<span class="next">
<a href="manually-configure-security.html">Manually configure security »</a>
</span>
</div>
</div>
</body>
</html>
